# Procurement Investigator - Default Configuration
# Override these values in investigate.config.yaml or .investigaterc.yaml

api:
  baseUrl: "https://api.usaspending.gov/api/v2"
  requestsPerSecond: 2
  maxRetries: 3
  pageSize: 100

cache:
  directory: ".cache"
  enabled: true

ai:
  enabled: true
  model: "claude-sonnet-4-5-20250929"

signals:
  R001_single_bid:
    enabled: true
    severityThreshold: 0.20      # >20% single-bid rate = high severity (EU benchmark)
    requireCompetitiveType: true  # Only count competitively-solicited awards

  R002_non_competitive:
    enabled: true
    codesToFlag:
      - "B"    # Not Available for Competition
      - "C"    # Not Competed
      - "G"    # Not Competed Under SAP
      - "NDO"  # Non-Competitive Delivery Order

  R003_splitting:
    enabled: true
    thresholds:
      - 250000     # Simplified Acquisition Threshold
      - 7500000    # Certain set-aside thresholds
    bandWidthPct: 0.10   # Flag awards within 10% below threshold
    minClusterSize: 3    # Minimum awards in band to flag
    period: "quarter"    # Group by quarter or year

  R004_concentration:
    enabled: true
    vendorShareThreshold: 0.30   # Flag if vendor has >30% of agency spend
    spikeThreshold: 0.15         # Flag if year-over-year increase >15%

  R005_modifications:
    enabled: true
    maxModificationCount: 5      # Flag contracts with >5 substantive mods
    maxGrowthRatio: 2.0          # Flag if total grows to >2x original

  R006_price_outliers:
    enabled: true
    method: "iqr"                # "iqr" or "zscore"
    iqrMultiplier: 1.5           # Q3 + 1.5*IQR (standard outlier detection)
    zscoreThreshold: 2.0         # >2 standard deviations above mean
    minGroupSize: 5              # Minimum awards per category to compute

# ── Materiality Filtering ────────────────────────────────────────────────────

materiality:
  minAwardCount: 1                 # Minimum affected awards for a finding
  minTotalAmount: 0                # Minimum dollar value for a finding
  maxFindings: 20                  # Maximum material findings to report
  maxPerIndicator: 5               # Max findings per indicator type (diversity cap)

# ── Multi-Source Enrichment ──────────────────────────────────────────────────

enrichment:
  samGov:
    enabled: true
    baseUrl: "https://api.sam.gov/entity-information/v3/entities"
    exclusionsUrl: "https://api.sam.gov/entity-information/v4/exclusions"
    requestsPerSecond: 1         # Conservative: free tier is 10 req/day
    maxRetries: 2
  openSanctions:
    enabled: true
    baseUrl: "https://api.opensanctions.org"
    dataset: "default"           # "default", "sanctions", "peps", "us_sanctions"
    scoreThreshold: 0.7          # Fuzzy match threshold (0.0-1.0)
    maxRetries: 2
  subAwards:
    enabled: true
    maxPerAward: 100             # Max sub-awards to fetch per prime award

# ── Opus 4.6 Investigative Agent ─────────────────────────────────────────────

investigator:
  enabled: true
  model: "claude-opus-4-6"
  maxIterations: 10              # Max reasoning loops before forced stop
  maxTokensPerTurn: 4096         # Agent needs room to reason
  maxCostUsd: 2.00               # Safety cap on estimated API cost
  toolChoice: "auto"             # "auto", "any", "none"

# ── Vega-Lite Charts ─────────────────────────────────────────────────────────

charts:
  enabled: true
  width: 700
  height: 400
  types:
    topVendors: true             # Horizontal bar: top 15 vendors by $ value
    competitionAnalysis: true    # Grouped bar: competition breakdown by count + dollars
    awardTimeline: true          # Monthly stacked bar: spending over time
    findingsExposure: true       # Horizontal bar: material findings by $ exposure
